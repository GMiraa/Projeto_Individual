<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./js/sessao.js"></script>
    <link rel="stylesheet" href="./style/quiz.css">
    <link rel="icon" href="./style/imagens/Logo da Planet Games.png">

    <title>Planet Games</title>
</head>
<body onload="onload()">

    <header>

        <div id="navbar">

            <img src="./style/imagens/Logo da Planet Games.png" alt="Logo" id="logo">

            <ul>
                <li><a href="./index.html">Home</a></li>
                <li><a href="#"><span id="selecionado">Quiz</span></a></li>
                <li><a href="./dashboard.html">Dashboard</a></li>
                <li><a href="./quemsomos.html">Origem</a></li>
            </ul>

            <div id="perfilLogin">
            <img src="./style/imagens/icone_usuario.png" alt="" id="perfil">
            <span id="b_usuario"><b><a href="./login.html">Entrar</a></b></span>
            </div>
            <div class="sair" onclick="limparSessao()">
                <h3><a href="./login.html">Sair</a></h3>
            </div>

        </div>

    </header>

    <video disablepictureinpicture autoplay src="./style/imagens/sunset-sky-ghost-of-tsushima-moewalls-com.mp4" muted loop id="videoFundo">
        <source src="" type="video/mp4">
    </video>

<div id="quiz">
    <div id="pontuacaoEJogo">
            <button id="iniciarQuiz" onclick="ComeçarQuiz()">Começar!</button>
            
            <div id="pontuacao" class="flexColumn width-fit-content">
                <div id="pontuacaoDuranteJogo" class="flexColumn padding-8">
                    <span class="width-fit-content">Quantidade de acertos: <span id="spanCertas"></span></span><br><br>
                    <span class="width-fit-content">Quantidade de erros: <span id="spanErradas"></span></span><br><br>
                </div>
                <div id="pontuacaoFinalJogo" class="flexColumn padding-8">
                    <span id="pontuacaoFinal" class="width-fit-content">Pontuação Final:
                        <span id="spanPontuacaoFinal">***</span><br><br>
                    </span>
                    <b><span id="msgFinal" class="width-fit-content">***</span></b>
                </div><br><br>
                <button onclick="tentar()" id="novamente" disabled>Tentar novamente</button>
            </div>

            <div id="jogo" class="width-fit-content flexColumn">

                <div id="infoQuestao" class="padding-8">
                    <span>Questão atual: <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span>
                        questões.</span>
                </div>

                <div id="perguntaDaQuestaoAtual" class="padding-8">
                    <span id="spanQuestaoExibida" class="pergunta"></span>
                </div>

                <div id="opcoes" class="flexColumn padding-8">

                    <span class="option">
                        <input type="radio" id="primeiraOpcao" name="option" class="radio" value="altA" />
                        <label for="primeiraOpcao" id="labelOpcaoUm"></label>
                    </span>

                    <span class="option">
                        <input type="radio" id="segundaOpcao" name="option" class="radio" value="altB" />
                        <label for="segundaOpcao" id="labelOpcaoDois"></label>
                    </span>

                    <span class="option">
                        <input type="radio" id="terceiraOpcao" name="option" class="radio" value="altC" />
                        <label for="terceiraOpcao" id="labelOpcaoTres"></label>
                    </span>

                    <span class="option">
                        <input type="radio" id="quartaOpcao" name="option" class="radio" value="altD" />
                        <label for="quartaOpcao" id="labelOpcaoQuatro"></label>
                    </span>

                </div>

                <div id="botoes" class="padding-8">
                    <button onclick="submeter()" id="btnSubmeter">Confirmar</button>
                    <button onclick="avancar()" id="btnProx" disabled>Próxima Pergunta</button>
                </div>

        </div>
    </div>

        <footer>

            <ul>
                <li><a href="./index.html">Home</a></li>
                <li><a href="#"><span id="selecionado">Quiz</span></a></li>
                <li><a href="./dashboard.html">Dashboard</a></li>
                <li><a href="./quemsomos.html">Origem</a></li>
            </ul>

                <p id="desenvolvido">Desenvolvido por <b>Guilherme Faria de Mira</b></p>

    </footer>
    
</body>
</html>

<script>

    var Questoes = [

        {
            pergunta: "1. Qual é o objetivo principal do jogo Minecraft?",
            altA: "a) Derrotar todos os jogadores adversários",
            altB: "b) Escapar de uma prisão",
            altC: "c) Explorar os oceanos em um mundo aberto",
            altD: "d) Construir, explorar e sobreviver em um mundo aberto",
            altCorreta: "altD"
        },

        {
            pergunta: "2. Em que jogo é possível construir estruturas enquanto combate inimigos?",
            altA: "a) PUBG",
            altB: "b) Fortnite",
            altC: "c) Apex Legends",
            altD: "d) Call of Duty: Warzone",
            altCorreta: "altB"
        },

        {
            pergunta: "3. Qual desses jogos é focado em batalhas entre equipes de 5 jogadores em três rotas?",
            altA: "a) League of Legends",
            altB: "b) Genshin Impact",
            altC: "c) Valorant",
            altD: "d) Rocket League",
            altCorreta: "altA"
        },

        {
            pergunta: "4. Qual empresa desenvolveu o jogo Free Fire?",
            altA: "a) Epic Games",
            altB: "b) Mojang",
            altC: "c) Garena",
            altD: "d) Riot Games",
            altCorreta: "altC"
        },

        {
            pergunta: "5. Em qual jogo os personagens utilizam habilidades e armas futuristas em partidas de tiro em equipe?",
            altA: "a) PUBG",
            altB: "b) Counter-Strike",
            altC: "c) Valorant",
            altD: "d) Roblox",
            altCorreta: "altC"
        },

        {
            pergunta: "6. Qual jogo é conhecido por permitir aos jogadores criar mundos e jogos personalizados dentro da própria plataforma?",
            altA: "a) League of Legends",
            altB: "b) Roblox",
            altC: "c) Rocket League",
            altD: "d) Fortnite",
            altCorreta: "altB"
        },

        {
            pergunta: "7. Qual desses jogos combina futebol com carros movidos a foguete?",
            altA: "a) Apex Legends",
            altB: "b) PUBG",
            altC: "c) Rocket League",
            altD: "d) Minecraft",
            altCorreta: "altC"
        },

        {
            pergunta: "8. Genshin Impact se passa em qual mundo fictício?",
            altA: "a) Runeterra",
            altB: "b) Tamriel",
            altC: "c) Teyvat",
            altD: "d) Hyrule",
            altCorreta: "altC"
        },

        {
            pergunta: "9. Em PUBG: Battlegrounds, quantos jogadores geralmente competem em uma partida padrão?",
            altA: "a) 100",
            altB: "b) 50",
            altC: "c) 25",
            altD: "d) 120",
            altCorreta: "altA"
        },

        {
            pergunta: "10. Qual é o principal recurso utilizado para invocar personagens em Genshin Impact?",
            altA: "a) Diamantes",
            altB: "b) Créditos",
            altC: "c) Destino entrelaçado (ou protogemas)",
            altD: "d) Pontos de prestígio",
            altCorreta: "altC"
        },
        
        {
            pergunta: "11. Qual desses jogos é um battle royale ambientado em um universo futurista com personagens únicos e habilidades especiais?",
            altA: "a) Call of Duty: Mobile",
            altB: "b) Apex Legends",
            altC: "c) Fortnite",
            altD: "d) Rocket League",
            altCorreta: "altB"
        },

        {
            pergunta: "12. Em League of Legends, qual é o nome da área principal onde ocorrem as partidas padrão?",
            altA: "a) Templo da Aurora",
            altB: "b) Caverna do Rei",
            altC: "c) Arena do Destino",
            altD: "d) Summoner's Rift",
            altCorreta: "altD"
        }

    ]

    var numeroDaQuestaoAtual = 0;
    var pontuacaoFinal = 0;
    var tentativaIncorreta = 0;
    var acertos = 0;
    var erros = 0;
    var quantidadeDeQuestoes = Questoes.length;

    var id = sessionStorage.ID_USUARIO;


    function onload(){

        onloadEsconder();
        validarSessao()

    }

    function onloadEsconder() {
        document.getElementById('pontuacao').style.display = "none"
        document.getElementById('jogo').style.display = "none"
    }

    function ComeçarQuiz() {
        document.getElementById('pontuacao').style.display = "none"
        document.getElementById('jogo').style.display = "flex"
        document.getElementById('iniciarQuiz').style.display = "none"

        document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes

        preencherHTMLcomQuestaoAtual(0)

        btnSubmeter.disabled = false
        btnProx.disabled = true
        // btnConcluir.disabled = true
        novamente.disabled = true
    }

    function preencherHTMLcomQuestaoAtual(index) {
        habilitarAlternativas(true)
        const questaoAtual = Questoes[index]
        numeroDaQuestaoAtual = index
        console.log("questaoAtual")
        console.log(questaoAtual)
        document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1 // ajustando porque o index começa em 0
        document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
        document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.altA;
        document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.altB;
        document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.altC;
        document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.altD;
    }

    function submeter() {
        const options = document.getElementsByName("option"); // recupera alternativas no html

        let hasChecked = false
        for (var i = 0; i < options.length; i++) {
            if (options[i].checked) {
                hasChecked = true;
                break;
            }
        }

        if (!hasChecked) {
            alert("Não há alternativas escolhidas. Escolha uma opção.");
        } else {
            btnSubmeter.disabled = true;
            btnProx.disabled = false;

            habilitarAlternativas(false);

            checarResposta();
        }
    }

    function habilitarAlternativas(trueOrFalse) {
        var opcaoEscolhida = trueOrFalse ? false : true

        primeiraOpcao.disabled = opcaoEscolhida;
        segundaOpcao.disabled = opcaoEscolhida;
        terceiraOpcao.disabled = opcaoEscolhida;
        quartaOpcao.disabled = opcaoEscolhida;

    }

    function avancar() {
        btnProx.disabled = true;
        btnSubmeter.disabled = false;

        desmarcarRadioButtons()

        if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual);
        } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) {
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual);
        } else {
            finalizarJogo();
        }
        limparCoresBackgroundOpcoes();
    }

    function tentar() {
        // atualiza a página
        window.location.reload()
    }

    function checarResposta() {
        const questaoAtual = Questoes[numeroDaQuestaoAtual]; // questão atual 
        const respostaQuestaoAtual = questaoAtual.altCorreta; // qual é a resposta correta da questão atual

        const options = document.getElementsByName("option"); // recupera alternativas no html

        var altCorreta = null; // variável para armazenar a alternativa correta

        options.forEach((option) => {
            if (option.value === respostaQuestaoAtual) {
                console.log("alternativaCorreta está no componente: " + altCorreta);
                altCorreta = option.labels[0].id;
            }
        })

        // verifica se resposta assinalada é correta
        options.forEach((option) => {
            if (option.checked === true && option.value === respostaQuestaoAtual) {
                document.getElementById(altCorreta).classList.add("certa");
                pontuacaoFinal++;
                acertos++;
                document.getElementById("spanCertas").innerHTML = acertos;
                numeroDaQuestaoAtual++;

            } else if (option.checked && option.value !== respostaQuestaoAtual) {
                const wrongLabelId = option.labels[0].id

                document.getElementById(wrongLabelId).classList.add("errada")
                document.getElementById(altCorreta).classList.add("certa")
                tentativaIncorreta++
                erros++
                document.getElementById("spanErradas").innerHTML = erros
                numeroDaQuestaoAtual++
            }
        })
    }

    function limparCoresBackgroundOpcoes() {
        const options = document.getElementsByName("option");
        options.forEach((option) => {
            document.getElementById(option.labels[0].id).classList.remove("errada")
            document.getElementById(option.labels[0].id).classList.remove("certa")
        })
    }

    function desmarcarRadioButtons() {
        const options = document.getElementsByName("option");
        for (let i = 0; i < options.length; i++) {
            options[i].checked = false;
        }
    }

    function finalizarJogo() {
        document.getElementById('pontuacao').style.display = "flex"
        document.getElementById('jogo').style.display = "none"
        let textoParaMensagemFinal = null
        let classComCoresParaMensagemFinal = null
        const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes

        if (porcentagemFinalDeAcertos <= 0.3) {
            textoParaMensagemFinal = "Muito noob"
            classComCoresParaMensagemFinal = "errada"
        }
        else if (porcentagemFinalDeAcertos > 0.3 && porcentagemFinalDeAcertos < 0.7) {
            textoParaMensagemFinal = "Até que sabe alguma coisa..."
            classComCoresParaMensagemFinal = "certa"
        }
        else if (porcentagemFinalDeAcertos >= 0.7) {
            textoParaMensagemFinal = "Viciado, vai viver um pouco!"
            classComCoresParaMensagemFinal = "certa"
        }

        textoParaMensagemFinal += "<br> Você acertou " + Math.round((porcentagemFinalDeAcertos)*100) + "% das questões."


        document.getElementById('msgFinal').innerHTML = textoParaMensagemFinal
        document.getElementById('msgFinal').classList.add(classComCoresParaMensagemFinal) 
        document.getElementById('spanPontuacaoFinal').innerHTML = pontuacaoFinal

        document.getElementById('jogo').classList.add("text-new-gray") 

        btnProx.disabled = true
        btnSubmeter.disabled = true
        novamente.disabled = false

        inserirResultados()

    }

    function inserirResultados(){

        fetch('/usuario/InserirResultado', {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              idUsuario: id,
              acertos: acertos,
              erros: erros,
            })
          })

    }


</script>